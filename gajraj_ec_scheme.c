
#include "contiki.h"
#include "net/netstack.h"
#include "net/nullnet/nullnet.h"
#include <string.h>
#include <stdio.h> 
#include <math.h>
//#include "dev/leds.h"
#include "cc2420.h"

/* Log configuration */
#include "sys/log.h"
#define LOG_MODULE "App"
#define LOG_LEVEL LOG_LEVEL_INFO
/*--------------------------------------*/
// DCT and sparsity parameters 

#define K 100 // define sparsity here 
#define M 120 // number of measurement 144 generates 6 packets with 96 bytes
#define signal_length 256 // signal length N
#define frame_length 96 // block length for a frame 
#define repeat_frame 500 // number of times repeats the complete signal 
#define frame_length_m M*4 
#define frac_part 13
/*-----------------------------------------
            N=128      N=256        N=512       N=1024
1/sqrt(N)   0x02d4     0x0200       0x016a      0x0100
sqrt(2/N)   0x0400     0x02d4       0x0200      0x016a
-------------------------------------------*/
// #define sqrtN  0x0200  // Change here corresponding to N
// #define sqrt2N 0x02d4  // Change here corresponding to N


#define double_len 2*signal_length



/* Configuration */
#define SEND_INTERVAL (13 * CLOCK_SECOND)


//static linkaddr_t dest_addr =  {{ 0x4c, 0xf9, 0x6f, 0x16, 0x00, 0x74, 0x12, 0x00 }};
  //static linkaddr_t dest_addr =  {{ 0xd8, 0xc8, 0x45, 0x1a, 0x00, 0x74, 0x12, 0x00 }};   //d8c8.451a.0074.1200   // Define the link address of the receiver 

/*---------------------------------------------------------------------------*/

PROCESS(CS_ENC_FEC_process, "Encryption compression and FEC example");
AUTOSTART_PROCESSES(&CS_ENC_FEC_process);

uint32_t  tx_measurement_buf[M];
/*---------------------------------------------------------------------------*/

// Qn.m fixed point multiplication 

int16_t multiply(int16_t a, int16_t b)
{
  
  int32_t result;
  int16_t out;
  result= (int32_t) a * b; // typecast to avoid oveflow error 

  result= result>>frac_part;  // bring back to the Qn.m formate 

  out=result;
   return out;
}
uint16_t SquareRoot( uint16_t Value ) // can be improved further 
       {
         uint16_t Root = 0;
         uint16_t Bit;
         for ( Bit = 0x4000; Bit > 0; Bit >>= 2 ) // worst performance Bit = 0x8000
           {
             uint16_t Trial = Root + Bit;
             Root >>= 1;
             if ( Trial <= Value )
               {
                 Root += Bit;
                 Value -= Trial;
               }
           }
           return Root;
         }

uint32_t * enc_function()
{

      
       //int16_t index_cos[signal_length], odd_value,var,temp2[signal_length],sign,value_ptr[signal_length-1];
       //int16_t tempCOS[signal_length];
        uint16_t i,k;

      // int16_t sqrtN,sqrt2N;
       //static int32_t dctData[K];

       // Change here corresponding to N

       /*---------------  FOr N=128  ------------------*/

        //int16_t COS_1[signal_length]={0x1fff,0x1ffa,0x1ff1,0x1fe2,0x1fce,0x1fb5,0x1f98,0x1f76,0x1f4e,0x1f22,0x1ef1,0x1ebc,0x1e81,0x1e42,0x1dff,0x1db6,0x1d69,0x1d18,0x1cc2,0x1c68,0x1c09,0x1ba6,0x1b3e,0x1ad3,0x1a63,0x19ef,0x1977,0x18fc,0x187c,0x17f9,0x1772,0x16e7,0x1659,0x15c7,0x1533,0x149a,0x13ff,0x1360,0x12bf,0x121a,0x1173,0x10c9,0x101d,0x0f6e,0x0ebd,0x0e09,0x0d53,0x0c9c,0x0be2,0x0b26,0x0a69,0x09aa,0x08ea,0x0828,0x0765,0x06a1,0x05db,0x0515,0x044e,0x0387,0x02bf,0x01f6,0x012e,0x0065,0xff9b,0xfed2,0xfe0a,0xfd41,0xfc79,0xfbb2,0xfaeb,0xfa25,0xf95f,0xf89b,0xf7d8,0xf716,0xf656,0xf597,0xf4da,0xf41e,0xf364,0xf2ad,0xf1f7,0xf143,0xf092,0xefe3,0xef37,0xee8d,0xede6,0xed41,0xeca0,0xec01,0xeb66,0xeacd,0xea39,0xe9a7,0xe919,0xe88e,0xe807,0xe784,0xe704,0xe689,0xe611,0xe59d,0xe52d,0xe4c2,0xe45a,0xe3f7,0xe398,0xe33e,0xe2e8,0xe297,0xe24a,0xe201,0xe1be,0xe17f,0xe144,0xe10f,0xe0de,0xe0b2,0xe08a,0xe068,0xe04b,0xe032,0xe01e,0xe00f,0xe006,0xe001};
        //int16_t ECG_sig[signal_length]={0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf452,0xf452,0xf4cd,0xf452,0xf452,0xf47b,0xf548,0xf59a,0xf5ec,0xf614,0xf63d,0xf614,0xf571,0xf4f6,0xf51f,0xf4cd,0xf452,0xf47b,0xf3d7,0xf35c,0xf385,0xf3ae,0xf35c,0xf30a,0xf28f,0xf266,0xf1ec,0xf1ec,0xf171,0xf171,0xf171,0xf1c3,0xf266,0xf266,0xf28f,0xf2e1,0xf30a,0xf2e1,0xf28f,0xf2e1,0xf30a,0xf333,0xf30a,0xf2e1,0xf333,0xf30a,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf35c,0xf333,0xf385,0xf3ae,0xf3d7,0xf429,0xf4cd,0xf5c3,0xf70a,0xf9c3,0xfd1f,0x01c3,0x0785,0x0e14,0x14a4,0x1ae1,0x2029,0x2266,0x21c3,0x1c52,0x135c,0x068f,0xf7d7,0xe87b,0xdb5c,0xd266,0xcf5c,0xd214,0xd785,0xde66,0xe571,0xea8f,0xee3d,0xf0f6,0xf23d,0xf2b8,0xf2e1,0xf28f,0xf28f,0xf23d,0xf2b8,0xf333,0xf400,0xf429,0xf47b,0xf47b,0xf4a4,0xf47b,0xf452,0xf452,0xf4a4,0xf4cd,0xf571,0xf63d,0xf6e1,0xf70a,0xf7ae,0xf733,0xf75c,0xf70a,0xf70a,0xf6e1,0xf70a,0xf70a,0xf70a,0xf75c,0xf75c,0xf733,0xf70a};
      
       /*----------------------------------------------*/

       /*---------------  FOr N=256  ------------------*/

       //int16_t COS_1[signal_length]={0x2000,0x1fff,0x1ffc,0x1ff8,0x1ff4,0x1fed,0x1fe6,0x1fdd,0x1fd3,0x1fc8,0x1fbc,0x1faf,0x1fa0,0x1f90,0x1f7f,0x1f6c,0x1f59,0x1f44,0x1f2e,0x1f17,0x1efe,0x1ee5,0x1eca,0x1eae,0x1e91,0x1e72,0x1e53,0x1e32,0x1e10,0x1ded,0x1dc9,0x1da4,0x1d7d,0x1d55,0x1d2d,0x1d03,0x1cd8,0x1cac,0x1c7f,0x1c50,0x1c21,0x1bf0,0x1bbf,0x1b8c,0x1b59,0x1b24,0x1aee,0x1ab7,0x1a7f,0x1a46,0x1a0d,0x19d2,0x1996,0x1959,0x191b,0x18dc,0x189c,0x185c,0x181a,0x17d8,0x1794,0x1750,0x170a,0x16c4,0x167d,0x1635,0x15ec,0x15a3,0x1558,0x150d,0x14c1,0x1474,0x1426,0x13d8,0x1388,0x1338,0x12e8,0x1296,0x1244,0x11f1,0x119d,0x1149,0x10f4,0x109f,0x1048,0x0ff1,0x0f9a,0x0f42,0x0ee9,0x0e90,0x0e36,0x0ddc,0x0d81,0x0d26,0x0cca,0x0c6d,0x0c10,0x0bb3,0x0b55,0x0af7,0x0a98,0x0a39,0x09da,0x097a,0x091a,0x08b9,0x0858,0x07f7,0x0796,0x0734,0x06d2,0x066f,0x060d,0x05aa,0x0547,0x04e4,0x0480,0x041d,0x03b9,0x0355,0x02f1,0x028d,0x0229,0x01c4,0x0160,0x00fb,0x0097,0x0032,0xffce,0xff69,0xff05,0xfea0,0xfe3c,0xfdd7,0xfd73,0xfd0f,0xfcab,0xfc47,0xfbe3,0xfb80,0xfb1c,0xfab9,0xfa56,0xf9f3,0xf991,0xf92e,0xf8cc,0xf86a,0xf809,0xf7a8,0xf747,0xf6e6,0xf686,0xf626,0xf5c7,0xf568,0xf509,0xf4ab,0xf44d,0xf3f0,0xf393,0xf336,0xf2da,0xf27f,0xf224,0xf1ca,0xf170,0xf117,0xf0be,0xf066,0xf00f,0xefb8,0xef61,0xef0c,0xeeb7,0xee63,0xee0f,0xedbc,0xed6a,0xed18,0xecc8,0xec78,0xec28,0xebda,0xeb8c,0xeb3f,0xeaf3,0xeaa8,0xea5d,0xea14,0xe9cb,0xe983,0xe93c,0xe8f6,0xe8b0,0xe86c,0xe828,0xe7e6,0xe7a4,0xe764,0xe724,0xe6e5,0xe6a7,0xe66a,0xe62e,0xe5f3,0xe5ba,0xe581,0xe549,0xe512,0xe4dc,0xe4a7,0xe474,0xe441,0xe410,0xe3df,0xe3b0,0xe381,0xe354,0xe328,0xe2fd,0xe2d3,0xe2ab,0xe283,0xe25c,0xe237,0xe213,0xe1f0,0xe1ce,0xe1ad,0xe18e,0xe16f,0xe152,0xe136,0xe11b,0xe102,0xe0e9,0xe0d2,0xe0bc,0xe0a7,0xe094,0xe081,0xe070,0xe060,0xe051,0xe044,0xe038,0xe02d,0xe023,0xe01a,0xe013,0xe00c,0xe008,0xe004,0xe001,0xe000};
        int16_t ECG_sig[signal_length]={0x0000,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf452,0xf452,0xf4cd,0xf452,0xf452,0xf47b,0xf548,0xf59a,0xf5ec,0xf614,0xf63d,0xf614,0xf571,0xf4f6,0xf51f,0xf4cd,0xf452,0xf47b,0xf3d7,0xf35c,0xf385,0xf3ae,0xf35c,0xf30a,0xf28f,0xf266,0xf1ec,0xf1ec,0xf171,0xf171,0xf171,0xf1c3,0xf266,0xf266,0xf28f,0xf2e1,0xf30a,0xf2e1,0xf28f,0xf2e1,0xf30a,0xf333,0xf30a,0xf2e1,0xf333,0xf30a,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf35c,0xf333,0xf385,0xf3ae,0xf3d7,0xf429,0xf4cd,0xf5c3,0xf70a,0xf9c3,0xfd1f,0x01c3,0x0785,0x0e14,0x14a4,0x1ae1,0x2029,0x2266,0x21c3,0x1c52,0x135c,0x068f,0xf7d7,0xe87b,0xdb5c,0xd266,0xcf5c,0xd214,0xd785,0xde66,0xe571,0xea8f,0xee3d,0xf0f6,0xf23d,0xf2b8,0xf2e1,0xf28f,0xf28f,0xf23d,0xf2b8,0xf333,0xf400,0xf429,0xf47b,0xf47b,0xf4a4,0xf47b,0xf452,0xf452,0xf4a4,0xf4cd,0xf571,0xf63d,0xf6e1,0xf70a,0xf7ae,0xf733,0xf75c,0xf70a,0xf70a,0xf6e1,0xf70a,0xf70a,0xf70a,0xf75c,0xf75c,0xf733,0xf70a,0xf6e1,0xf6e1,0xf6b8,0xf6b8,0xf666,0xf6b8,0xf68f,0xf70a,0xf733,0xf75c,0xf75c,0xf75c,0xf800,0xf800,0xf829,0xf8cd,0xf8f6,0xf948,0xfa3d,0xfae1,0xfb85,0xfc29,0xfcf6,0xfdc3,0xfe14,0xfe14,0xfeb8,0xff33,0xff5c,0xffd7,0x0029,0x007b,0x00f6,0x019a,0x01c3,0x01ec,0x019a,0x0148,0x00a4,0x00cd,0x007b,0x00cd,0x0052,0xffd7,0xffae,0xff33,0xfe8f,0xfd9a,0xfccd,0xfc00,0xfb5c,0xfa14,0xf99a,0xf8cd,0xf852,0xf7d7,0xf785,0xf70a,0xf6b8,0xf63d,0xf59a,0xf571,0xf4cd,0xf429,0xf3ae,0xf385,0xf3ae,0xf35c,0xf35c,0xf385,0xf385,0xf385,0xf35c,0xf333,0xf333,0xf2e1,0xf2b8,0xf266,0xf2b8,0xf2e1,0xf333,0xf385,0xf3d7,0xf3d7,0xf400,0xf385,0xf3ae,0xf35c,0xf385,0xf385,0xf3d7,0xf452,0xf3d7,0xf429,0xf47b,0xf452,0xf4cd,0xf452,0xf400,0xf400,0xf429,0xf400,0xf452,0xf452,0xf47b,0xf452,0xf429,0xf429,0xf400,0xf400,0xf400,0xf385,0xf385,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf385,0xf30a,0xf2b8,0xf23d,0xf23d,0xf19a,0xf171,0xf214};
      
       /*----------------------------------------------*/

       
        /*---------------  FOr N=512  ------------------*/
        
        //int16_t COS_1[signal_length]={0x2000,0x2000,0x1fff,0x1ffe,0x1ffd,0x1ffb,0x1ff9,0x1ff7,0x1ff5,0x1ff2,0x1fef,0x1fec,0x1fe8,0x1fe4,0x1fe0,0x1fdb,0x1fd6,0x1fd1,0x1fcb,0x1fc5,0x1fbf,0x1fb9,0x1fb2,0x1fab,0x1fa4,0x1f9c,0x1f94,0x1f8c,0x1f83,0x1f7a,0x1f71,0x1f67,0x1f5e,0x1f54,0x1f49,0x1f3e,0x1f33,0x1f28,0x1f1c,0x1f11,0x1f04,0x1ef8,0x1eeb,0x1ede,0x1ed1,0x1ec3,0x1eb5,0x1ea7,0x1e98,0x1e89,0x1e7a,0x1e6a,0x1e5b,0x1e4b,0x1e3a,0x1e2a,0x1e19,0x1e07,0x1df6,0x1de4,0x1dd2,0x1dc0,0x1dad,0x1d9a,0x1d87,0x1d73,0x1d5f,0x1d4b,0x1d37,0x1d22,0x1d0d,0x1cf8,0x1ce3,0x1ccd,0x1cb7,0x1ca1,0x1c8a,0x1c73,0x1c5c,0x1c45,0x1c2d,0x1c15,0x1bfd,0x1be4,0x1bcb,0x1bb2,0x1b99,0x1b7f,0x1b66,0x1b4b,0x1b31,0x1b16,0x1afc,0x1ae0,0x1ac5,0x1aa9,0x1a8d,0x1a71,0x1a55,0x1a38,0x1a1b,0x19fe,0x19e1,0x19c3,0x19a5,0x1987,0x1968,0x194a,0x192b,0x190b,0x18ec,0x18cc,0x18ad,0x188c,0x186c,0x184b,0x182b,0x180a,0x17e8,0x17c7,0x17a5,0x1783,0x1761,0x173e,0x171c,0x16f9,0x16d6,0x16b2,0x168f,0x166b,0x1647,0x1623,0x15fe,0x15da,0x15b5,0x1590,0x156b,0x1545,0x1520,0x14fa,0x14d4,0x14ad,0x1487,0x1460,0x1439,0x1412,0x13eb,0x13c4,0x139c,0x1374,0x134c,0x1324,0x12fc,0x12d3,0x12aa,0x1282,0x1258,0x122f,0x1206,0x11dc,0x11b2,0x1188,0x115e,0x1134,0x1109,0x10df,0x10b4,0x1089,0x105e,0x1033,0x1007,0x0fdc,0x0fb0,0x0f84,0x0f58,0x0f2c,0x0eff,0x0ed3,0x0ea6,0x0e7a,0x0e4d,0x0e20,0x0df3,0x0dc5,0x0d98,0x0d6a,0x0d3d,0x0d0f,0x0ce1,0x0cb3,0x0c84,0x0c56,0x0c28,0x0bf9,0x0bca,0x0b9c,0x0b6d,0x0b3e,0x0b0f,0x0adf,0x0ab0,0x0a81,0x0a51,0x0a22,0x09f2,0x09c2,0x0992,0x0962,0x0932,0x0902,0x08d1,0x08a1,0x0871,0x0840,0x0810,0x07df,0x07ae,0x077d,0x074c,0x071b,0x06ea,0x06b9,0x0688,0x0657,0x0626,0x05f4,0x05c3,0x0591,0x0560,0x052e,0x04fd,0x04cb,0x0499,0x0467,0x0436,0x0404,0x03d2,0x03a0,0x036e,0x033c,0x030a,0x02d8,0x02a6,0x0274,0x0242,0x020f,0x01dd,0x01ab,0x0179,0x0147,0x0114,0x00e2,0x00b0,0x007e,0x004b,0x0019,0xffe7,0xffb5,0xff82,0xff50,0xff1e,0xfeec,0xfeb9,0xfe87,0xfe55,0xfe23,0xfdf1,0xfdbe,0xfd8c,0xfd5a,0xfd28,0xfcf6,0xfcc4,0xfc92,0xfc60,0xfc2e,0xfbfc,0xfbca,0xfb99,0xfb67,0xfb35,0xfb03,0xfad2,0xfaa0,0xfa6f,0xfa3d,0xfa0c,0xf9da,0xf9a9,0xf978,0xf947,0xf916,0xf8e5,0xf8b4,0xf883,0xf852,0xf821,0xf7f0,0xf7c0,0xf78f,0xf75f,0xf72f,0xf6fe,0xf6ce,0xf69e,0xf66e,0xf63e,0xf60e,0xf5de,0xf5af,0xf57f,0xf550,0xf521,0xf4f1,0xf4c2,0xf493,0xf464,0xf436,0xf407,0xf3d8,0xf3aa,0xf37c,0xf34d,0xf31f,0xf2f1,0xf2c3,0xf296,0xf268,0xf23b,0xf20d,0xf1e0,0xf1b3,0xf186,0xf15a,0xf12d,0xf101,0xf0d4,0xf0a8,0xf07c,0xf050,0xf024,0xeff9,0xefcd,0xefa2,0xef77,0xef4c,0xef21,0xeef7,0xeecc,0xeea2,0xee78,0xee4e,0xee24,0xedfa,0xedd1,0xeda8,0xed7e,0xed56,0xed2d,0xed04,0xecdc,0xecb4,0xec8c,0xec64,0xec3c,0xec15,0xebee,0xebc7,0xeba0,0xeb79,0xeb53,0xeb2c,0xeb06,0xeae0,0xeabb,0xea95,0xea70,0xea4b,0xea26,0xea02,0xe9dd,0xe9b9,0xe995,0xe971,0xe94e,0xe92a,0xe907,0xe8e4,0xe8c2,0xe89f,0xe87d,0xe85b,0xe839,0xe818,0xe7f6,0xe7d5,0xe7b5,0xe794,0xe774,0xe753,0xe734,0xe714,0xe6f5,0xe6d5,0xe6b6,0xe698,0xe679,0xe65b,0xe63d,0xe61f,0xe602,0xe5e5,0xe5c8,0xe5ab,0xe58f,0xe573,0xe557,0xe53b,0xe520,0xe504,0xe4ea,0xe4cf,0xe4b5,0xe49a,0xe481,0xe467,0xe44e,0xe435,0xe41c,0xe403,0xe3eb,0xe3d3,0xe3bb,0xe3a4,0xe38d,0xe376,0xe35f,0xe349,0xe333,0xe31d,0xe308,0xe2f3,0xe2de,0xe2c9,0xe2b5,0xe2a1,0xe28d,0xe279,0xe266,0xe253,0xe240,0xe22e,0xe21c,0xe20a,0xe1f9,0xe1e7,0xe1d6,0xe1c6,0xe1b5,0xe1a5,0xe196,0xe186,0xe177,0xe168,0xe159,0xe14b,0xe13d,0xe12f,0xe122,0xe115,0xe108,0xe0fc,0xe0ef,0xe0e4,0xe0d8,0xe0cd,0xe0c2,0xe0b7,0xe0ac,0xe0a2,0xe099,0xe08f,0xe086,0xe07d,0xe074,0xe06c,0xe064,0xe05c,0xe055,0xe04e,0xe047,0xe041,0xe03b,0xe035,0xe02f,0xe02a,0xe025,0xe020,0xe01c,0xe018,0xe014,0xe011,0xe00e,0xe00b,0xe009,0xe007,0xe005,0xe003,0xe002,0xe001,0xe000,0xe000};
        //int16_t ECG_sig[signal_length]={0x0000,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf452,0xf452,0xf4cd,0xf452,0xf452,0xf47b,0xf548,0xf59a,0xf5ec,0xf614,0xf63d,0xf614,0xf571,0xf4f6,0xf51f,0xf4cd,0xf452,0xf47b,0xf3d7,0xf35c,0xf385,0xf3ae,0xf35c,0xf30a,0xf28f,0xf266,0xf1ec,0xf1ec,0xf171,0xf171,0xf171,0xf1c3,0xf266,0xf266,0xf28f,0xf2e1,0xf30a,0xf2e1,0xf28f,0xf2e1,0xf30a,0xf333,0xf30a,0xf2e1,0xf333,0xf30a,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf35c,0xf333,0xf385,0xf3ae,0xf3d7,0xf429,0xf4cd,0xf5c3,0xf70a,0xf9c3,0xfd1f,0x01c3,0x0785,0x0e14,0x14a4,0x1ae1,0x2029,0x2266,0x21c3,0x1c52,0x135c,0x068f,0xf7d7,0xe87b,0xdb5c,0xd266,0xcf5c,0xd214,0xd785,0xde66,0xe571,0xea8f,0xee3d,0xf0f6,0xf23d,0xf2b8,0xf2e1,0xf28f,0xf28f,0xf23d,0xf2b8,0xf333,0xf400,0xf429,0xf47b,0xf47b,0xf4a4,0xf47b,0xf452,0xf452,0xf4a4,0xf4cd,0xf571,0xf63d,0xf6e1,0xf70a,0xf7ae,0xf733,0xf75c,0xf70a,0xf70a,0xf6e1,0xf70a,0xf70a,0xf70a,0xf75c,0xf75c,0xf733,0xf70a,0xf6e1,0xf6e1,0xf6b8,0xf6b8,0xf666,0xf6b8,0xf68f,0xf70a,0xf733,0xf75c,0xf75c,0xf75c,0xf800,0xf800,0xf829,0xf8cd,0xf8f6,0xf948,0xfa3d,0xfae1,0xfb85,0xfc29,0xfcf6,0xfdc3,0xfe14,0xfe14,0xfeb8,0xff33,0xff5c,0xffd7,0x0029,0x007b,0x00f6,0x019a,0x01c3,0x01ec,0x019a,0x0148,0x00a4,0x00cd,0x007b,0x00cd,0x0052,0xffd7,0xffae,0xff33,0xfe8f,0xfd9a,0xfccd,0xfc00,0xfb5c,0xfa14,0xf99a,0xf8cd,0xf852,0xf7d7,0xf785,0xf70a,0xf6b8,0xf63d,0xf59a,0xf571,0xf4cd,0xf429,0xf3ae,0xf385,0xf3ae,0xf35c,0xf35c,0xf385,0xf385,0xf385,0xf35c,0xf333,0xf333,0xf2e1,0xf2b8,0xf266,0xf2b8,0xf2e1,0xf333,0xf385,0xf3d7,0xf3d7,0xf400,0xf385,0xf3ae,0xf35c,0xf385,0xf385,0xf3d7,0xf452,0xf3d7,0xf429,0xf47b,0xf452,0xf4cd,0xf452,0xf400,0xf400,0xf429,0xf400,0xf452,0xf452,0xf47b,0xf452,0xf429,0xf429,0xf400,0xf400,0xf400,0xf385,0xf385,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf385,0xf30a,0xf2b8,0xf23d,0xf23d,0xf19a,0xf171,0xf214,0xf23d,0xf23d,0xf28f,0xf2b8,0xf2b8,0xf266,0xf214,0xf19a,0xf171,0xf148,0xf171,0xf148,0xf19a,0xf1c3,0xf171,0xf1c3,0xf19a,0xf171,0xf11f,0xf19a,0xf19a,0xf1c3,0xf19a,0xf23d,0xf2b8,0xf30a,0xf385,0xf3ae,0xf429,0xf429,0xf4a4,0xf4cd,0xf4f6,0xf47b,0xf47b,0xf429,0xf400,0xf35c,0xf35c,0xf385,0xf333,0xf333,0xf28f,0xf23d,0xf1c3,0xf11f,0xf0a4,0xf07b,0xf052,0xf052,0xf052,0xf029,0xefae,0xeee1,0xeee1,0xee66,0xee66,0xee8f,0xee3d,0xef33,0xef85,0xefd7,0xf052,0xf029,0xf029,0xefae,0xef5c,0xef0a,0xeee1,0xeeb8,0xeee1,0xef0a,0xef5c,0xef85,0xf000,0xf000,0xf029,0xefd7,0xefd7,0xefae,0xefae,0xef85,0xef85,0xf000,0xf0a4,0xf19a,0xf3ae,0xf68f,0xfae1,0xff5c,0x063d,0x0cf6,0x1400,0x1ab8,0x2029,0x23ae,0x23d7,0x2000,0x17ae,0x0b5c,0xfc00,0xeb85,0xdb85,0xcfd7,0xc99a,0xca14,0xcf5c,0xd70a,0xdf5c,0xe666,0xeccd,0xf000,0xf2b8,0xf333,0xf35c,0xf333,0xf2b8,0xf266,0xf1ec,0xf2b8,0xf385,0xf3d7,0xf4a4,0xf4cd,0xf548,0xf571,0xf59a,0xf5ec,0xf6b8,0xf6b8,0xf75c,0xf852,0xf8a4,0xf971,0xfa14,0xfa66,0xfb0a,0xfb85,0xfb85,0xfbae,0xfb85,0xfbae,0xfb85,0xfbae,0xfbd7,0xfc00,0xfc52,0xfc7b,0xfc7b,0xfc7b,0xfc7b,0xfc29,0xfc29,0xfc7b,0xfccd,0xfd9a,0xfdec,0xfeb8,0xff33,0xffae,0x0052,0x007b,0x00cd,0x00f6,0x0171,0x01c3,0x028f,0x035c,0x03d7,0x0452,0x04cd,0x0548,0x051f,0x04f6,0x051f,0x0571,0x0571,0x051f,0x059a,0x05c3,0x0571,0x0571,0x05ec,0x05ec,0x05c3,0x05c3,0x051f,0x04f6,0x047b,0x0429,0x03d7,0x0385,0x02b8,0x028f,0x0171,0x0148,0x00f6,0xffae,0xfe66,0xfd9a,0xfc52,0xfb5c,0xfa66,0xf99a,0xf971,0xf8f6,0xf8cd,0xf852,0xf7ae,0xf6e1,0xf614,0xf548,0xf4a4,0xf452,0xf400,0xf3d7,0xf400,0xf3d7,0xf3ae,0xf3ae,0xf385,0xf3ae,0xf30a,0xf2b8,0xf2e1,0xf28f,0xf2b8,0xf2e1,0xf28f,0xf2b8,0xf333,0xf385,0xf333,0xf333,0xf2b8,0xf2e1,0xf2b8,0xf2b8,0xf2e1,0xf30a,0xf30a,0xf385,0xf3ae,0xf400,0xf47b,0xf47b,0xf429,0xf400,0xf400,0xf3d7,0xf3ae,0xf3d7,0xf429,0xf452,0xf4a4,0xf47b};
         
        /*----------------------------------------------*/

        /*---------------  FOr N=1024  ------------------*/
        //     int16_t COS_1[signal_length]={0x2000,0x2000,0x2000,0x2000,0x1fff,0x1fff,0x1ffe,0x1ffe,0x1ffd,0x1ffd,0x1ffc,0x1ffb,0x1ffa,0x1ff9,0x1ff8,0x1ff7,0x1ff6,0x1ff4,0x1ff3,0x1ff1,0x1ff0,0x1fee,0x1fec,0x1feb,0x1fe9,0x1fe7,0x1fe5,0x1fe3,0x1fe1,0x1fde,0x1fdc,0x1fda,0x1fd7,0x1fd5,0x1fd2,0x1fcf,0x1fcd,0x1fca,0x1fc7,0x1fc4,0x1fc1,0x1fbe,0x1fba,0x1fb7,0x1fb4,0x1fb0,0x1fad,0x1fa9,0x1fa5,0x1fa2,0x1f9e,0x1f9a,0x1f96,0x1f92,0x1f8e,0x1f8a,0x1f85,0x1f81,0x1f7c,0x1f78,0x1f73,0x1f6f,0x1f6a,0x1f65,0x1f60,0x1f5b,0x1f56,0x1f51,0x1f4c,0x1f46,0x1f41,0x1f3c,0x1f36,0x1f31,0x1f2b,0x1f25,0x1f1f,0x1f1a,0x1f14,0x1f0e,0x1f07,0x1f01,0x1efb,0x1ef5,0x1eee,0x1ee8,0x1ee1,0x1edb,0x1ed4,0x1ecd,0x1ec6,0x1ebf,0x1eb8,0x1eb1,0x1eaa,0x1ea3,0x1e9c,0x1e94,0x1e8d,0x1e85,0x1e7e,0x1e76,0x1e6e,0x1e66,0x1e5f,0x1e57,0x1e4f,0x1e46,0x1e3e,0x1e36,0x1e2e,0x1e25,0x1e1d,0x1e14,0x1e0c,0x1e03,0x1dfa,0x1df1,0x1de9,0x1de0,0x1dd7,0x1dcd,0x1dc4,0x1dbb,0x1db2,0x1da8,0x1d9f,0x1d95,0x1d8c,0x1d82,0x1d78,0x1d6e,0x1d64,0x1d5a,0x1d50,0x1d46,0x1d3c,0x1d32,0x1d28,0x1d1d,0x1d13,0x1d08,0x1cfe,0x1cf3,0x1ce8,0x1cdd,0x1cd2,0x1cc7,0x1cbc,0x1cb1,0x1ca6,0x1c9b,0x1c90,0x1c84,0x1c79,0x1c6d,0x1c62,0x1c56,0x1c4a,0x1c3f,0x1c33,0x1c27,0x1c1b,0x1c0f,0x1c03,0x1bf7,0x1bea,0x1bde,0x1bd2,0x1bc5,0x1bb9,0x1bac,0x1b9f,0x1b93,0x1b86,0x1b79,0x1b6c,0x1b5f,0x1b52,0x1b45,0x1b38,0x1b2a,0x1b1d,0x1b10,0x1b02,0x1af5,0x1ae7,0x1ada,0x1acc,0x1abe,0x1ab0,0x1aa2,0x1a94,0x1a86,0x1a78,0x1a6a,0x1a5c,0x1a4e,0x1a3f,0x1a31,0x1a22,0x1a14,0x1a05,0x19f7,0x19e8,0x19d9,0x19ca,0x19bb,0x19ac,0x199d,0x198e,0x197f,0x1970,0x1961,0x1951,0x1942,0x1932,0x1923,0x1913,0x1904,0x18f4,0x18e4,0x18d4,0x18c4,0x18b5,0x18a5,0x1894,0x1884,0x1874,0x1864,0x1854,0x1843,0x1833,0x1822,0x1812,0x1801,0x17f1,0x17e0,0x17cf,0x17be,0x17ad,0x179c,0x178b,0x177a,0x1769,0x1758,0x1747,0x1736,0x1724,0x1713,0x1702,0x16f0,0x16de,0x16cd,0x16bb,0x16a9,0x1698,0x1686,0x1674,0x1662,0x1650,0x163e,0x162c,0x161a,0x1608,0x15f5,0x15e3,0x15d1,0x15be,0x15ac,0x1599,0x1587,0x1574,0x1561,0x154f,0x153c,0x1529,0x1516,0x1503,0x14f0,0x14dd,0x14ca,0x14b7,0x14a4,0x1491,0x147d,0x146a,0x1457,0x1443,0x1430,0x141c,0x1409,0x13f5,0x13e1,0x13ce,0x13ba,0x13a6,0x1392,0x137e,0x136a,0x1356,0x1342,0x132e,0x131a,0x1306,0x12f2,0x12dd,0x12c9,0x12b5,0x12a0,0x128c,0x1277,0x1263,0x124e,0x123a,0x1225,0x1210,0x11fb,0x11e7,0x11d2,0x11bd,0x11a8,0x1193,0x117e,0x1169,0x1154,0x113f,0x1129,0x1114,0x10ff,0x10e9,0x10d4,0x10bf,0x10a9,0x1094,0x107e,0x1069,0x1053,0x103e,0x1028,0x1012,0x0ffc,0x0fe7,0x0fd1,0x0fbb,0x0fa5,0x0f8f,0x0f79,0x0f63,0x0f4d,0x0f37,0x0f21,0x0f0b,0x0ef4,0x0ede,0x0ec8,0x0eb2,0x0e9b,0x0e85,0x0e6e,0x0e58,0x0e42,0x0e2b,0x0e14,0x0dfe,0x0de7,0x0dd1,0x0dba,0x0da3,0x0d8c,0x0d76,0x0d5f,0x0d48,0x0d31,0x0d1a,0x0d03,0x0cec,0x0cd5,0x0cbe,0x0ca7,0x0c90,0x0c79,0x0c62,0x0c4b,0x0c33,0x0c1c,0x0c05,0x0bed,0x0bd6,0x0bbf,0x0ba7,0x0b90,0x0b79,0x0b61,0x0b4a,0x0b32,0x0b1a,0x0b03,0x0aeb,0x0ad4,0x0abc,0x0aa4,0x0a8d,0x0a75,0x0a5d,0x0a45,0x0a2d,0x0a16,0x09fe,0x09e6,0x09ce,0x09b6,0x099e,0x0986,0x096e,0x0956,0x093e,0x0926,0x090e,0x08f6,0x08de,0x08c5,0x08ad,0x0895,0x087d,0x0865,0x084c,0x0834,0x081c,0x0803,0x07eb,0x07d3,0x07ba,0x07a2,0x0789,0x0771,0x0759,0x0740,0x0728,0x070f,0x06f7,0x06de,0x06c6,0x06ad,0x0694,0x067c,0x0663,0x064b,0x0632,0x0619,0x0601,0x05e8,0x05cf,0x05b6,0x059e,0x0585,0x056c,0x0553,0x053b,0x0522,0x0509,0x04f0,0x04d7,0x04be,0x04a6,0x048d,0x0474,0x045b,0x0442,0x0429,0x0410,0x03f7,0x03de,0x03c5,0x03ac,0x0393,0x037a,0x0361,0x0348,0x032f,0x0316,0x02fd,0x02e4,0x02cb,0x02b2,0x0299,0x0280,0x0267,0x024e,0x0235,0x021c,0x0203,0x01ea,0x01d1,0x01b8,0x019f,0x0185,0x016c,0x0153,0x013a,0x0121,0x0108,0x00ef,0x00d6,0x00bc,0x00a3,0x008a,0x0071,0x0058,0x003f,0x0026,0x000d,0xfff3,0xffda,0xffc1,0xffa8,0xff8f,0xff76,0xff5d,0xff44,0xff2a,0xff11,0xfef8,0xfedf,0xfec6,0xfead,0xfe94,0xfe7b,0xfe61,0xfe48,0xfe2f,0xfe16,0xfdfd,0xfde4,0xfdcb,0xfdb2,0xfd99,0xfd80,0xfd67,0xfd4e,0xfd35,0xfd1c,0xfd03,0xfcea,0xfcd1,0xfcb8,0xfc9f,0xfc86,0xfc6d,0xfc54,0xfc3b,0xfc22,0xfc09,0xfbf0,0xfbd7,0xfbbe,0xfba5,0xfb8c,0xfb73,0xfb5a,0xfb42,0xfb29,0xfb10,0xfaf7,0xfade,0xfac5,0xfaad,0xfa94,0xfa7b,0xfa62,0xfa4a,0xfa31,0xfa18,0xf9ff,0xf9e7,0xf9ce,0xf9b5,0xf99d,0xf984,0xf96c,0xf953,0xf93a,0xf922,0xf909,0xf8f1,0xf8d8,0xf8c0,0xf8a7,0xf88f,0xf877,0xf85e,0xf846,0xf82d,0xf815,0xf7fd,0xf7e4,0xf7cc,0xf7b4,0xf79b,0xf783,0xf76b,0xf753,0xf73b,0xf722,0xf70a,0xf6f2,0xf6da,0xf6c2,0xf6aa,0xf692,0xf67a,0xf662,0xf64a,0xf632,0xf61a,0xf602,0xf5ea,0xf5d3,0xf5bb,0xf5a3,0xf58b,0xf573,0xf55c,0xf544,0xf52c,0xf515,0xf4fd,0xf4e6,0xf4ce,0xf4b6,0xf49f,0xf487,0xf470,0xf459,0xf441,0xf42a,0xf413,0xf3fb,0xf3e4,0xf3cd,0xf3b5,0xf39e,0xf387,0xf370,0xf359,0xf342,0xf32b,0xf314,0xf2fd,0xf2e6,0xf2cf,0xf2b8,0xf2a1,0xf28a,0xf274,0xf25d,0xf246,0xf22f,0xf219,0xf202,0xf1ec,0xf1d5,0xf1be,0xf1a8,0xf192,0xf17b,0xf165,0xf14e,0xf138,0xf122,0xf10c,0xf0f5,0xf0df,0xf0c9,0xf0b3,0xf09d,0xf087,0xf071,0xf05b,0xf045,0xf02f,0xf019,0xf004,0xefee,0xefd8,0xefc2,0xefad,0xef97,0xef82,0xef6c,0xef57,0xef41,0xef2c,0xef17,0xef01,0xeeec,0xeed7,0xeec1,0xeeac,0xee97,0xee82,0xee6d,0xee58,0xee43,0xee2e,0xee19,0xee05,0xedf0,0xeddb,0xedc6,0xedb2,0xed9d,0xed89,0xed74,0xed60,0xed4b,0xed37,0xed23,0xed0e,0xecfa,0xece6,0xecd2,0xecbe,0xecaa,0xec96,0xec82,0xec6e,0xec5a,0xec46,0xec32,0xec1f,0xec0b,0xebf7,0xebe4,0xebd0,0xebbd,0xeba9,0xeb96,0xeb83,0xeb6f,0xeb5c,0xeb49,0xeb36,0xeb23,0xeb10,0xeafd,0xeaea,0xead7,0xeac4,0xeab1,0xea9f,0xea8c,0xea79,0xea67,0xea54,0xea42,0xea2f,0xea1d,0xea0b,0xe9f8,0xe9e6,0xe9d4,0xe9c2,0xe9b0,0xe99e,0xe98c,0xe97a,0xe968,0xe957,0xe945,0xe933,0xe922,0xe910,0xe8fe,0xe8ed,0xe8dc,0xe8ca,0xe8b9,0xe8a8,0xe897,0xe886,0xe875,0xe864,0xe853,0xe842,0xe831,0xe820,0xe80f,0xe7ff,0xe7ee,0xe7de,0xe7cd,0xe7bd,0xe7ac,0xe79c,0xe78c,0xe77c,0xe76c,0xe75b,0xe74b,0xe73c,0xe72c,0xe71c,0xe70c,0xe6fc,0xe6ed,0xe6dd,0xe6ce,0xe6be,0xe6af,0xe69f,0xe690,0xe681,0xe672,0xe663,0xe654,0xe645,0xe636,0xe627,0xe618,0xe609,0xe5fb,0xe5ec,0xe5de,0xe5cf,0xe5c1,0xe5b2,0xe5a4,0xe596,0xe588,0xe57a,0xe56c,0xe55e,0xe550,0xe542,0xe534,0xe526,0xe519,0xe50b,0xe4fe,0xe4f0,0xe4e3,0xe4d6,0xe4c8,0xe4bb,0xe4ae,0xe4a1,0xe494,0xe487,0xe47a,0xe46d,0xe461,0xe454,0xe447,0xe43b,0xe42e,0xe422,0xe416,0xe409,0xe3fd,0xe3f1,0xe3e5,0xe3d9,0xe3cd,0xe3c1,0xe3b6,0xe3aa,0xe39e,0xe393,0xe387,0xe37c,0xe370,0xe365,0xe35a,0xe34f,0xe344,0xe339,0xe32e,0xe323,0xe318,0xe30d,0xe302,0xe2f8,0xe2ed,0xe2e3,0xe2d8,0xe2ce,0xe2c4,0xe2ba,0xe2b0,0xe2a6,0xe29c,0xe292,0xe288,0xe27e,0xe274,0xe26b,0xe261,0xe258,0xe24e,0xe245,0xe23c,0xe233,0xe229,0xe220,0xe217,0xe20f,0xe206,0xe1fd,0xe1f4,0xe1ec,0xe1e3,0xe1db,0xe1d2,0xe1ca,0xe1c2,0xe1ba,0xe1b1,0xe1a9,0xe1a1,0xe19a,0xe192,0xe18a,0xe182,0xe17b,0xe173,0xe16c,0xe164,0xe15d,0xe156,0xe14f,0xe148,0xe141,0xe13a,0xe133,0xe12c,0xe125,0xe11f,0xe118,0xe112,0xe10b,0xe105,0xe0ff,0xe0f9,0xe0f2,0xe0ec,0xe0e6,0xe0e1,0xe0db,0xe0d5,0xe0cf,0xe0ca,0xe0c4,0xe0bf,0xe0ba,0xe0b4,0xe0af,0xe0aa,0xe0a5,0xe0a0,0xe09b,0xe096,0xe091,0xe08d,0xe088,0xe084,0xe07f,0xe07b,0xe076,0xe072,0xe06e,0xe06a,0xe066,0xe062,0xe05e,0xe05b,0xe057,0xe053,0xe050,0xe04c,0xe049,0xe046,0xe042,0xe03f,0xe03c,0xe039,0xe036,0xe033,0xe031,0xe02e,0xe02b,0xe029,0xe026,0xe024,0xe022,0xe01f,0xe01d,0xe01b,0xe019,0xe017,0xe015,0xe014,0xe012,0xe010,0xe00f,0xe00d,0xe00c,0xe00a,0xe009,0xe008,0xe007,0xe006,0xe005,0xe004,0xe003,0xe003,0xe002,0xe002,0xe001,0xe001,0xe000,0xe000,0xe000,0xe000};
         //    int16_t ECG_sig[signal_length]={0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf3d7,0xf452,0xf452,0xf4cd,0xf452,0xf452,0xf47b,0xf548,0xf59a,0xf5ec,0xf614,0xf63d,0xf614,0xf571,0xf4f6,0xf51f,0xf4cd,0xf452,0xf47b,0xf3d7,0xf35c,0xf385,0xf3ae,0xf35c,0xf30a,0xf28f,0xf266,0xf1ec,0xf1ec,0xf171,0xf171,0xf171,0xf1c3,0xf266,0xf266,0xf28f,0xf2e1,0xf30a,0xf2e1,0xf28f,0xf2e1,0xf30a,0xf333,0xf30a,0xf2e1,0xf333,0xf30a,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf3ae,0xf35c,0xf333,0xf385,0xf3ae,0xf3d7,0xf429,0xf4cd,0xf5c3,0xf70a,0xf9c3,0xfd1f,0x01c3,0x0785,0x0e14,0x14a4,0x1ae1,0x2029,0x2266,0x21c3,0x1c52,0x135c,0x068f,0xf7d7,0xe87b,0xdb5c,0xd266,0xcf5c,0xd214,0xd785,0xde66,0xe571,0xea8f,0xee3d,0xf0f6,0xf23d,0xf2b8,0xf2e1,0xf28f,0xf28f,0xf23d,0xf2b8,0xf333,0xf400,0xf429,0xf47b,0xf47b,0xf4a4,0xf47b,0xf452,0xf452,0xf4a4,0xf4cd,0xf571,0xf63d,0xf6e1,0xf70a,0xf7ae,0xf733,0xf75c,0xf70a,0xf70a,0xf6e1,0xf70a,0xf70a,0xf70a,0xf75c,0xf75c,0xf733,0xf70a,0xf6e1,0xf6e1,0xf6b8,0xf6b8,0xf666,0xf6b8,0xf68f,0xf70a,0xf733,0xf75c,0xf75c,0xf75c,0xf800,0xf800,0xf829,0xf8cd,0xf8f6,0xf948,0xfa3d,0xfae1,0xfb85,0xfc29,0xfcf6,0xfdc3,0xfe14,0xfe14,0xfeb8,0xff33,0xff5c,0xffd7,0x0029,0x007b,0x00f6,0x019a,0x01c3,0x01ec,0x019a,0x0148,0x00a4,0x00cd,0x007b,0x00cd,0x0052,0xffd7,0xffae,0xff33,0xfe8f,0xfd9a,0xfccd,0xfc00,0xfb5c,0xfa14,0xf99a,0xf8cd,0xf852,0xf7d7,0xf785,0xf70a,0xf6b8,0xf63d,0xf59a,0xf571,0xf4cd,0xf429,0xf3ae,0xf385,0xf3ae,0xf35c,0xf35c,0xf385,0xf385,0xf385,0xf35c,0xf333,0xf333,0xf2e1,0xf2b8,0xf266,0xf2b8,0xf2e1,0xf333,0xf385,0xf3d7,0xf3d7,0xf400,0xf385,0xf3ae,0xf35c,0xf385,0xf385,0xf3d7,0xf452,0xf3d7,0xf429,0xf47b,0xf452,0xf4cd,0xf452,0xf400,0xf400,0xf429,0xf400,0xf452,0xf452,0xf47b,0xf452,0xf429,0xf429,0xf400,0xf400,0xf400,0xf385,0xf385,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf35c,0xf385,0xf30a,0xf2b8,0xf23d,0xf23d,0xf19a,0xf171,0xf214,0xf23d,0xf23d,0xf28f,0xf2b8,0xf2b8,0xf266,0xf214,0xf19a,0xf171,0xf148,0xf171,0xf148,0xf19a,0xf1c3,0xf171,0xf1c3,0xf19a,0xf171,0xf11f,0xf19a,0xf19a,0xf1c3,0xf19a,0xf23d,0xf2b8,0xf30a,0xf385,0xf3ae,0xf429,0xf429,0xf4a4,0xf4cd,0xf4f6,0xf47b,0xf47b,0xf429,0xf400,0xf35c,0xf35c,0xf385,0xf333,0xf333,0xf28f,0xf23d,0xf1c3,0xf11f,0xf0a4,0xf07b,0xf052,0xf052,0xf052,0xf029,0xefae,0xeee1,0xeee1,0xee66,0xee66,0xee8f,0xee3d,0xef33,0xef85,0xefd7,0xf052,0xf029,0xf029,0xefae,0xef5c,0xef0a,0xeee1,0xeeb8,0xeee1,0xef0a,0xef5c,0xef85,0xf000,0xf000,0xf029,0xefd7,0xefd7,0xefae,0xefae,0xef85,0xef85,0xf000,0xf0a4,0xf19a,0xf3ae,0xf68f,0xfae1,0xff5c,0x063d,0x0cf6,0x1400,0x1ab8,0x2029,0x23ae,0x23d7,0x2000,0x17ae,0x0b5c,0xfc00,0xeb85,0xdb85,0xcfd7,0xc99a,0xca14,0xcf5c,0xd70a,0xdf5c,0xe666,0xeccd,0xf000,0xf2b8,0xf333,0xf35c,0xf333,0xf2b8,0xf266,0xf1ec,0xf2b8,0xf385,0xf3d7,0xf4a4,0xf4cd,0xf548,0xf571,0xf59a,0xf5ec,0xf6b8,0xf6b8,0xf75c,0xf852,0xf8a4,0xf971,0xfa14,0xfa66,0xfb0a,0xfb85,0xfb85,0xfbae,0xfb85,0xfbae,0xfb85,0xfbae,0xfbd7,0xfc00,0xfc52,0xfc7b,0xfc7b,0xfc7b,0xfc7b,0xfc29,0xfc29,0xfc7b,0xfccd,0xfd9a,0xfdec,0xfeb8,0xff33,0xffae,0x0052,0x007b,0x00cd,0x00f6,0x0171,0x01c3,0x028f,0x035c,0x03d7,0x0452,0x04cd,0x0548,0x051f,0x04f6,0x051f,0x0571,0x0571,0x051f,0x059a,0x05c3,0x0571,0x0571,0x05ec,0x05ec,0x05c3,0x05c3,0x051f,0x04f6,0x047b,0x0429,0x03d7,0x0385,0x02b8,0x028f,0x0171,0x0148,0x00f6,0xffae,0xfe66,0xfd9a,0xfc52,0xfb5c,0xfa66,0xf99a,0xf971,0xf8f6,0xf8cd,0xf852,0xf7ae,0xf6e1,0xf614,0xf548,0xf4a4,0xf452,0xf400,0xf3d7,0xf400,0xf3d7,0xf3ae,0xf3ae,0xf385,0xf3ae,0xf30a,0xf2b8,0xf2e1,0xf28f,0xf2b8,0xf2e1,0xf28f,0xf2b8,0xf333,0xf385,0xf333,0xf333,0xf2b8,0xf2e1,0xf2b8,0xf2b8,0xf2e1,0xf30a,0xf30a,0xf385,0xf3ae,0xf400,0xf47b,0xf47b,0xf429,0xf400,0xf400,0xf3d7,0xf3ae,0xf3d7,0xf429,0xf452,0xf4a4,0xf47b,0xf47b,0xf400,0xf3d7,0xf385,0xf30a,0xf2b8,0xf266,0xf28f,0xf266,0xf2b8,0xf2b8,0xf266,0xf214,0xf1ec,0xf11f,0xf11f,0xf0a4,0xf11f,0xf11f,0xf148,0xf0cd,0xf11f,0xf11f,0xf148,0xf11f,0xf11f,0xf0f6,0xf171,0xf11f,0xf171,0xf19a,0xf1c3,0xf266,0xf385,0xf400,0xf4f6,0xf548,0xf571,0xf5ec,0xf614,0xf614,0xf614,0xf70a,0xf785,0xf800,0xf8a4,0xf8f6,0xf91f,0xf8cd,0xf87b,0xf785,0xf733,0xf666,0xf666,0xf5ec,0xf548,0xf4f6,0xf4a4,0xf3d7,0xf30a,0xf2e1,0xf2b8,0xf214,0xf1ec,0xf19a,0xf07b,0xefd7,0xef5c,0xef5c,0xefae,0xf029,0xf000,0xefd7,0xf000,0xef85,0xef5c,0xef0a,0xee66,0xee66,0xee66,0xee8f,0xeeb8,0xeee1,0xee66,0xeeb8,0xee8f,0xee14,0xedc3,0xed9a,0xed1f,0xed71,0xee8f,0xef33,0xefae,0xf07b,0xf11f,0xf214,0xf3ae,0xf68f,0xfa8f,0x0029,0x063d,0x0d1f,0x14a4,0x1b85,0x219a,0x247b,0x2400,0x1f85,0x1614,0x08f6,0xf91f,0xe829,0xd829,0xccf6,0xc7ae,0xc948,0xcee1,0xd70a,0xde66,0xe4cd,0xe8f6,0xebae,0xed1f,0xed1f,0xeca4,0xec00,0xec00,0xec52,0xeca4,0xed71,0xedec,0xee3d,0xedec,0xee3d,0xee66,0xee66,0xeeb8,0xeee1,0xefae,0xf029,0xf0cd,0xf171,0xf1c3,0xf1c3,0xf266,0xf266,0xf28f,0xf30a,0xf35c,0xf400,0xf47b,0xf4a4,0xf548,0xf59a,0xf63d,0xf68f,0xf6e1,0xf6e1,0xf733,0xf785,0xf829,0xf852,0xf8a4,0xf8f6,0xf9ec,0xfa66,0xfae1,0xfb5c,0xfbd7,0xfc00,0xfc00,0xfca4,0xfcf6,0xfd48,0xfe14,0xff0a,0xffd7,0x007b,0x00f6,0x00cd,0x00cd,0x011f,0x00cd,0x0052,0x00cd,0x00f6,0x011f,0x0148,0x019a,0x011f,0x011f,0x00cd,0x007b,0x007b,0x0052,0x0000,0xffae,0xff33,0xfe8f,0xfe14,0xfd9a,0xfd48,0xfca4,0xfbae,0xfb0a,0xfa14,0xf8f6,0xf7d7,0xf6e1,0xf614,0xf4f6,0xf47b,0xf400,0xf3ae,0xf3ae,0xf333,0xf266,0xf214,0xf171,0xf0f6,0xf07b,0xf0a4,0xf0a4,0xf0cd,0xf0f6,0xf0f6,0xf07b,0xf0a4,0xf0cd,0xf029,0xf029,0xf07b,0xf029,0xf07b,0xf07b,0xf07b,0xf0a4,0xf11f,0xf0f6,0xf148,0xf0f6,0xf0f6,0xf11f,0xf0f6,0xf0f6,0xf11f,0xf0cd,0xf11f,0xf148,0xf1c3,0xf23d,0xf214,0xf266,0xf23d,0xf214,0xf19a,0xf148,0xf148,0xf148,0xf171,0xf19a,0xf1c3,0xf214,0xf1ec,0xf171,0xf148,0xf0a4,0xf0a4,0xf029,0xefae,0xf052,0xf052,0xf052,0xf07b,0xf029,0xf000,0xf000,0xef85,0xef0a,0xeee1,0xef0a,0xef0a,0xef5c,0xf000,0xefd7,0xf029,0xf07b,0xf052,0xf07b,0xf07b,0xf0cd,0xf0cd,0xf0a4,0xf0a4,0xf07b,0xf11f,0xf148,0xf1ec,0xf28f,0xf30a,0xf385,0xf35c,0xf333,0xf30a,0xf333,0xf385,0xf400,0xf452,0xf47b,0xf4cd,0xf452,0xf4a4,0xf429,0xf429,0xf3ae,0xf385,0xf333,0xf30a,0xf2e1,0xf2b8,0xf1ec,0xf19a,0xf1c3,0xf11f,0xf11f,0xf0cd,0xf07b,0xefd7,0xefae,0xeeb8,0xeeb8,0xeeb8,0xeee1,0xeeb8,0xeeb8,0xef33,0xef0a,0xef0a,0xeee1,0xee66,0xee3d,0xee3d,0xeeb8,0xef33,0xef85,0xefae,0xf052,0xf07b,0xf0a4,0xf0cd,0xf11f,0xf0f6,0xf11f,0xf19a,0xf214,0xf2e1,0xf35c,0xf452,0xf4a4,0xf5c3,0xf87b,0xfc00,0x0052,0x059a,0x0c29,0x1333,0x1a3d,0x2148,0x2666,0x287b,0x26b8,0x2029,0x15ec,0x07d7,0xf6e1,0xe59a,0xd614,0xcbae,0xc7d7,0xcb0a,0xd28f,0xdbae,0xe3d7,0xeab8,0xef5c,0xf214,0xf400,0xf400,0xf3d7,0xf2e1,0xf2b8,0xf2e1,0xf30a,0xf333,0xf385,0xf400,0xf3d7,0xf35c,0xf35c,0xf2e1,0xf385,0xf35c,0xf3ae,0xf452,0xf47b,0xf4cd,0xf548,0xf548,0xf571,0xf548,0xf571,0xf5c3,0xf59a,0xf63d,0xf68f,0xf6e1,0xf7ae,0xf7d7,0xf852,0xf8a4,0xf8cd,0xf91f,0xf91f,0xf971,0xf9ec,0xfa14,0xfa8f,0xfae1,0xfb33,0xfbae,0xfc00,0xfccd,0xfcf6,0xfcf6,0xfd71,0xfd9a,0xfdec,0xfe3d,0xfe8f,0xff0a,0xff5c,0x0052,0x00a4,0x007b,0x00a4,0x0052,0x007b,0x007b,0x00a4,0x00cd,0x0148,0x011f,0x0171,0x019a,0x01c3,0x01c3,0x01ec,0x01c3,0x0148,0x0148,0x00cd,0x007b,0xffae,0xff5c,0xfe8f,0xfdc3,0xfd48,0xfca4,0xfbd7,0xfab8,0xf948,0xf852,0xf75c,0xf614,0xf51f,0xf571,0xf4f6,0xf47b,0xf452,0xf3d7,0xf35c,0xf2b8,0xf266,0xf23d,0xf1ec,0xf1c3,0xf214,0xf28f,0xf266,0xf23d,0xf23d,0xf266,0xf30a,0xf30a,0xf385,0xf35c,0xf3d7,0xf400,0xf452,0xf4cd,0xf452,0xf4cd,0xf571,0xf59a,0xf4f6,0xf4f6,0xf4f6,0xf4cd,0xf4f6,0xf548,0xf51f,0xf614};
             
        /*----------------------------------------------*/


      uint16_t initialValue1[4]={0x7abc,0x7fd8,0x6532,0x1234},initialValue2[4]={0xbabc,0x7fd8,0x6532,0x1234};
      static uint32_t measurement;  
    // feedback variables for 4 LFSRs
      uint16_t fb1,fb2;
      uint8_t fb3,initialValue3={0xaf};
      uint32_t energyConst=0x000f0000;
      //static uint8_t parity=0; 
      
 // indexing Variable used for the generation of sensing matrix 
      measurement=0x00000000;
    for ( i = 1; i <signal_length ; ++i)
    {
      measurement=measurement + multiply(ECG_sig[i],ECG_sig[i]);
      
      
    }
    //printf("%08lx\n", measurement);
     measurement=energyConst-measurement; // 0x000f0000 is 32.13 representation of 120
     
    ECG_sig[0]=(SquareRoot((uint16_t)(measurement>>4))<<7); // read this variable with Q16.13 However this variable is not important at receiver 
    //printf("Clock system time before Encryption: %u \n",(unsigned int)clock_seconds());
   //printf(" \n %04lx \n",(uint32_t)measurement );
//printf("Clock system time Starting Encryption: %u \n",clock_time());

  for(k=0;k<M;k++)
  {
            tx_measurement_buf[k]=0x00000000;
            for (i=0; i<signal_length; i++)
            { 

            //  Defining the LFSR feedback value X^32+X^22+x^2+x^1+1 
                    
            //fb1=((initialValue1[0])^(initialValue1[0]<<10)^(initialValue1[1]<<14)^(initialValue1[1]<<15))&0x8000; 
            // if ((initialValue1[0]&0x8000)==0x8000)
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue1[0]&0x0020)==0x0020)
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue1[1]&0x0002)==0x0002)
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue1[1]&0x0001)==0x0001)
            // {
            //   parity=parity+1;
            // }

            // if((parity==0)||(parity%2==0))
            // {
            //   fb1=0x0000;
            // }
            // else
            // {
            //   fb1=0x8000;
            // }
            // parity=0;

              // Another LFSR 
              // x^32+x^30+x^26+x^25+1
            //fb1=((initialValue1[0])^(initialValue1[0]<<2)^(initialValue1[0]<<6)^(initialValue1[0]<<7))&0x8000;  
            // Another LFSR 
              // x^63+x^62+1
              fb1=((initialValue1[0])^(initialValue1[0]<<1))&0x4000;
            initialValue1[3]=initialValue1[3]>>1; // shifting the value to the right 
            initialValue1[3]=(initialValue1[3])|((initialValue1[2]&0x0001)<<15); // Continueing the process shifting 
            initialValue1[2]=initialValue1[2]>>1; // shifting the value to the right 
            initialValue1[2]=(initialValue1[2])|((initialValue1[1]&0x0001)<<15);
            initialValue1[1]=initialValue1[1]>>1; // shifting the value to the right 
            initialValue1[1]=(initialValue1[1])|((initialValue1[0]&0x0001)<<15);
            initialValue1[0]=(initialValue1[0]>>1);
            initialValue1[0]=initialValue1[0]|fb1; // Updating the feedback value in the end of LFSR 
            
            //printf("%u,",fb1>>15);  // fb1 contains either 0x8000 or 0x0000 therefore printed values are 0 or 32678. To get 0 and 1 fb1 has to be shifted 15 times 

        //fb2=(initialValue2[0]&0x8000)^(initialValue2[0]&0x0020)^(initialValue2[0]&0x0010)^(initialValue2[0]&0x0008)^(initialValue2[0]&0x0002)^(initialValue2[0]&0x0001)^(initialValue2[1]&0x7000)^(initialValue2[1]&0x1000)^(initialValue2[1]&0x0700)^(initialValue2[1]&0x0200)^(initialValue2[1]&0x0080)^(initialValue2[1]&0x0020)^(initialValue2[1]&0x0008)^(initialValue2[1]&0x0001);
            
            //x^32 + x^22 + x^21 + x^20 + x^18 + x^17 + x^15 + x^13 + x^12 + x^10 + x^8 + x^6 + x^4 + x^1 + 1

            // fb2=((initialValue2[0])^(initialValue2[0]<<10)^(initialValue2[0]<<11)^(initialValue2[0]<<12)^(initialValue2[0]<<14)^(initialValue2[0]<<15)^(initialValue2[1]<<1)^(initialValue2[1]<<3)^(initialValue2[1]<<4)^(initialValue2[1]<<6)^(initialValue2[1]<<8)^(initialValue2[1]<<10)^(initialValue2[1]<<12)^(initialValue2[1]<<15))&0x8000;
            // initialValue2[1]=initialValue2[1]>>1; // shifting the value to the right 
            // initialValue2[1]=(initialValue2[1])|((initialValue2[0]&0x0001)<<15); // Continueing the  shifting process
            // initialValue2[0]=initialValue2[0]>>1;
            // initialValue2[0]=(initialValue2[0])|fb2; // Updating the feedback value in the end of LFSR 
     
     // New LFSR to increase Key size and period      
           //x^64+x^63+x^61+x^60+1

            fb2=((initialValue2[0])^(initialValue2[0]<<1)^(initialValue2[0]<<3)^(initialValue2[0]<<4))&0x8000;
            
            // if ((initialValue2[0]&0x8000)==0x8000) //x^64
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue2[0]&0x4000)==0x4000)  //x^63
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue2[0]&0x1000)==0x1000) // x^61
            // {
            //   parity=parity+1;
            // }
            //  if ((initialValue2[0]&0x0800)==0x0800)  // x^60
            // {
            //   parity=parity+1;
            // }

            // if((parity==0)||(parity%2==0))
            // {
            //   fb2=0x0000;
            // }
            // else
            // {
            //   fb2=0x8000;
            // }
            // parity=0;

            initialValue2[3]=initialValue2[3]>>1;
            initialValue2[3]=(initialValue2[3])|((initialValue2[2]&0x0001)<<15);
            initialValue2[2]=initialValue2[2]>>1;
            initialValue2[2]=(initialValue2[2])|((initialValue2[1]&0x0001)<<15);
            initialValue2[1]=initialValue2[1]>>1;
            initialValue2[1]=(initialValue2[1])|((initialValue2[0]&0x0001)<<15);
            initialValue2[0]=initialValue2[0]>>1;
            initialValue2[0]=(initialValue2[0])|fb2;

            // //x^32 + x^23 + x^17 + x^16 + x^14 + x^10 + x^8 + x^7 + x^6 + x^5 + x^3 + 1
            // fb3=((initialValue3[0])^(initialValue3[0]<<9)^(initialValue3[0]<<15)^(initialValue3[1])^(initialValue3[1]<<2)^(initialValue3[1]<<6)^(initialValue3[1]<<8)^(initialValue3[1]<<9)^(initialValue3[1]<<10)^(initialValue3[1]<<11)^(initialValue3[1]<<13))&0x8000;
            // initialValue3[1]=initialValue3[1]>>1; // shifting the value to the right 
            // initialValue3[1]=(initialValue3[1])|((initialValue3[0]&0x0001)<<15); // Continueing the  shifting process
            // initialValue3[0]=initialValue3[0]>>1;
            // initialValue3[0]=(initialValue3[0])|(fb3); // Updating the feedback value in the end of LFSR 
            
            //NFSR generation
             // feedback polynomial x_0+x_1+x_5+(x_1&x_5)
            fb3=(initialValue3^(initialValue3<<1)^(initialValue3<<5)^((initialValue3<<1)&(initialValue3<<5)));
            fb3=fb3&0x80;
            initialValue3=(initialValue3<<1)|(fb3>>7);
            
            // x^32 + x^28 + x^19 + x^18 + x^16 + x^14 + x^11 + x^10 + x^9 + x^6 + x^5 + x^1 + 1

            // fb4=((initialValue4[0])^(initialValue4[0]<<4)^(initialValue4[0]<<13)^(initialValue4[0]<<14)^(initialValue4[1])^(initialValue4[1]<<2)^(initialValue4[1]<<5)^(initialValue4[1]<<6)^(initialValue4[1]<<7)^(initialValue4[1]<<10)^(initialValue4[1]<<11)^(initialValue4[1]<<15))&0x8000;
            // initialValue4[1]=initialValue4[1]>>1; // shifting the value to the right 
            // initialValue4[1]=initialValue4[1]|((initialValue4[0]&0x0001)<<15); // Continueing the  shifting process
            // initialValue4[0]=initialValue4[0]>>1;
            // initialValue4[0]=initialValue4[0]|(fb4); // Updating the feedback value in the end of LFSR 

              //printf("%u,",fb4>>15); 
              // Introducing nonlinearity by and operaion of fb3 and fb4
              //if((((fb3>>15)==0)&&((fb4>>15)==0))||(((fb3>>15)==1)&&((fb4>>15)==1)))
            
              
                if(((fb1&0x4000)&&(fb2&0x8000))||((fb1&0x4000)&&(fb3&0x80))||((fb2&0x8000)&&(fb3&0x80)))
                {
                tx_measurement_buf[k]=tx_measurement_buf[k]+ECG_sig[i];
                }
                else
                {
                tx_measurement_buf[k]=tx_measurement_buf[k]-ECG_sig[i];
                }
             
          }

                 


  }

//printf(" \n ");


return tx_measurement_buf;
}

/*--------------------------------------------------------------------------*/
PROCESS_THREAD(CS_ENC_FEC_process, ev, data)
{
  static struct etimer periodic_timer;
 
  

  PROCESS_BEGIN();

 
static uint32_t *payP;

        printf("Clock system time before Encryption: %u seconds\n",(unsigned int)clock_seconds());
        payP = enc_function(); 
        printf("Clock system time after Encryption: %u seconds\n",(unsigned int)clock_seconds());
        printf("\nClock ticks after Encryption: %u \n Number of ticks in One second %u\n",(unsigned int)clock_time(), (unsigned int) CLOCK_SECOND);
        //printf("Clock system time after Encryption: %u \n",(unsigned int)clock_seconds());

        
       etimer_set(&periodic_timer, SEND_INTERVAL);
      static uint16_t i;

       for ( i = 0; i < M; ++i)
         printf("%08lx ", payP[i]);

    
            while(1) {
                 


                
                     PROCESS_WAIT_EVENT_UNTIL(etimer_expired(&periodic_timer));
                     //printf("In the while loop:\n");
            
                
            }


       


  PROCESS_END();
}


/*---------------------------------------------------------------------------*/

